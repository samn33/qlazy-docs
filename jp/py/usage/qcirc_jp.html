

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>量子回路実行(Backendクラス, QCircクラス) &mdash; qlazy  documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> qlazy
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Install.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Tutorial_en.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Tutorial_jp.html">Tutorial (japanese)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../python-api/qlazy.html">qlazy package</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">qlazy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>量子回路実行(Backendクラス, QCircクラス)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/jp/py/usage/qcirc_jp.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="backend-qcirc">
<h1>量子回路実行(Backendクラス, QCircクラス)<a class="headerlink" href="#backend-qcirc" title="Permalink to this heading">¶</a></h1>
<div class="section" id="id1">
<h2>量子回路実行の基本<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h2>
<p>量子コンピュータで量子計算を行うというのは、欲しい結果を得るように設計
された量子回路を量子コンピュータに投入して測定結果を取得するということ
です。qlazyでは量子コンピュータをBackendクラスで用意して、それにQCirc
クラスで作成した量子回路を指定することで量子計算を実行します。</p>
<div class="section" id="id2">
<h3>量子コンピュータの用意<a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h3>
<p>Backendクラスのインスタンスを生成する際に引数product(製品名)と引数
device(デバイス名)を指定することで量子計算させる量子コンピュータ(また
はシミュレータ)を設定します。例えば、qlazyというproductの
qstate_simulator(状態ベクトルシミュレータ)というdeviceで計算させたい場
合は、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">qlazy</span> <span class="kn">import</span> <span class="n">Backend</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bk</span> <span class="o">=</span> <span class="n">Backend</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;qlazy&#39;</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;qstate_simulator&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>とします。qlazyのstabilizer_simulator(スタビライザーシミュレータ)で計
算させたい場合、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bk</span> <span class="o">=</span> <span class="n">Backend</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;qlazy&#39;</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;stabilizer_simulator&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>とします。qlazyのmps_simulator(行列積状態シミュレータ)で計算させたい場
合、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bk</span> <span class="o">=</span> <span class="n">Backend</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;qlazy&#39;</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;mps_simulator&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>とします。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bk</span> <span class="o">=</span> <span class="n">Backend</span><span class="p">()</span>
</pre></div>
</div>
<p>のようにproductとdeviceを指定しない場合、qlazyのqstate_simulatorが指定
されます。</p>
<p>その他、現在のバージョンで対応しているバックエンドは、
<a class="reference external" href="https://github.com/qulacs/qulacs">qulacs</a>と<a class="reference external" href="https://quantum-computing.ibm.com/">IBM Quantum(IBMQ)</a>
と<a class="reference external" href="https://aws.amazon.com/braket/?nc1=h_ls">Amazon Braket(LocalSimulator,AWS,IonQ,Rigetti,OQC)</a>です。
使用法などの詳細は「対応しているバックエンド」(後述)をご参照ください。</p>
<p>対応しているproductは、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">Backend</span><span class="o">.</span><span class="n">products</span><span class="p">())</span>
<span class="go">[&#39;qlazy&#39;, &#39;qulacs&#39;, &#39;ibmq&#39;, &#39;braket_local&#39;, &#39;braket_aws&#39;, &#39;braket_ionq&#39;, &#39;braket_rigetti&#39;, &#39;braket_oqc&#39;]</span>
</pre></div>
</div>
<p>とすれば確認できます。各々のproductで使えるdeviceは、例えば、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">Backend</span><span class="o">.</span><span class="n">devices</span><span class="p">(</span><span class="s1">&#39;ibmq&#39;</span><span class="p">))</span>
<span class="go">[&#39;aer_simulator&#39;, &#39;least_busy&#39;, &#39;ibmq_armonk&#39;, &#39;ibmq_bogota&#39;, &#39;ibmq_lima&#39;, &#39;ibmq_belem&#39;, &#39;ibmq_quito&#39;, &#39;ibmq_manila&#39;]</span>
</pre></div>
</div>
<p>とすれば確認できます。</p>
</div>
<div class="section" id="id3">
<h3>量子回路の作成<a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h3>
<div class="section" id="id4">
<h4>ユニタリゲート<a class="headerlink" href="#id4" title="Permalink to this heading">¶</a></h4>
<p>量子コンピュータが用意できたら、次に量子回路を作成します。QStateクラス
やDensopクラスと同じ記法でQCircクラスのインスタンスにゲートを追加して
いきます。例えば、Bell状態を作成する回路を作成したい場合は、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">qlazy</span> <span class="kn">import</span> <span class="n">QCirc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>のようにします。ここでhはアダマールゲート、cxはCNOTゲートを表します。
または、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>のようにゲートをつなげて書いてもOKです。</p>
<p>これで、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">--</span><span class="n">H</span><span class="o">--*---</span>
          <span class="o">|</span>
<span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-----</span><span class="n">X</span><span class="o">---</span>
</pre></div>
</div>
<p>という回路が作成されたことになります。ここで、q[0],q[1]は量子ビットの
番号（量子レジスタ番号）を表しています。</p>
</div>
<div class="section" id="id5">
<h4>パウリ積ゲート<a class="headerlink" href="#id5" title="Permalink to this heading">¶</a></h4>
<p>パウリ演算子X,Y,Zのテンソル積を定義して量子回路に追加することができま
す。パウリ積を扱うために、まず、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">qlazy</span> <span class="kn">import</span> <span class="n">QCirc</span><span class="p">,</span> <span class="n">PauliProduct</span>
</pre></div>
</div>
<p>のようにPauliProductクラスをimportする必要があります。例えば、3量子ビッ
トの状態に対して、X2 Y0 Z1というパウリ積を演算したい場合、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pp</span> <span class="o">=</span> <span class="n">PauliProduct</span><span class="p">(</span><span class="n">pauli_str</span><span class="o">=</span><span class="s2">&quot;XYZ&quot;</span><span class="p">,</span> <span class="n">qid</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">operate</span><span class="p">(</span><span class="n">pp</span><span class="o">=</span><span class="n">pp</span><span class="p">)</span>
</pre></div>
</div>
<p>のようにoperateメソッドのppオプションにPauliProductのインスタンスを指
定します。制御化されたパウリ積はoperateメソッドのqctrlオプションに制御
量子ビット番号を指定することで実現できます。以下のようにします。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pp</span> <span class="o">=</span> <span class="n">PauliProduct</span><span class="p">(</span><span class="n">pauli_str</span><span class="o">=</span><span class="s2">&quot;XYZ&quot;</span><span class="p">,</span> <span class="n">qid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">operate</span><span class="p">(</span><span class="n">pp</span><span class="o">=</span><span class="n">pp</span><span class="p">,</span> <span class="n">qctlr</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h4>測定ゲート<a class="headerlink" href="#id6" title="Permalink to this heading">¶</a></h4>
<p>測定する場合は、測定ゲートに測定する量子ビット番号のリストqidとその値
を格納するための古典ビット番号（古典メモリ番号または古典レジスタ番号）
のリストcidを指定します(qidとcidの長さは一致していなければなりません)。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">qid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">cid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<p>図で書くと、以下のような量子回路が作成されたことになります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">--</span><span class="n">H</span><span class="o">--*---</span><span class="n">M</span>
          <span class="o">|</span>   <span class="o">|</span>
<span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-----</span><span class="n">X</span><span class="o">---|--</span><span class="n">M</span>
              <span class="o">|</span>  <span class="o">|</span>
<span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">---------*--|--</span>
                 <span class="o">|</span>
<span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">------------*--</span>
</pre></div>
</div>
<p>ここで、c[0],c[1]は古典ビット番号を表しています。</p>
<p>古典ビットに格納されている測定結果に応じて、以降のゲート制御をしたい
ことがあります。そのような一例を以下に示します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">qid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ctrl</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ctrl</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">qid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">cid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<p>h(0).cx(0,1)を追加した後にmeasure(qid=[0],cid=[0])を追加しています。つ
まり、0番目の量子ビットの測定結果を0番目の古典レジスタに格納します。次
にx(0, ctrl=0)と続きます。xはQStateクラスやDensOpクラスと同様パウリXゲー
トを表しており、最初の引数は適用する量子ビット番号です。QCircクラスで
は、ctrlという引数も指定することができます。これはこのゲートを適用する
か否かをctrlで指定した古典ビット番号に格納されている測定値によって決め
るということを表すためのものです(qiskitのc_ifに対応)。いまの例の場合、
前段のmeasureで0番目の量子ビットの測定結果を0番目の古典レジスタに格納
していたので、その値が0であったか1であったかによってパウリXゲートが実
行されるかどうかが決まります。1だった場合パウリXゲートが実行されます。
次のx(1, ctrl=0)も同様の考え方で実行が制御されるパウリXゲートです。最
後に再びmeasureです。今度は0番目と1番目の量子ビットが測定され、結果が0
番目と1番目の古典レジスタに格納されます。図で書くと、以下のような量子
回路が作成されたことになります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">--</span><span class="n">H</span><span class="o">--*---</span><span class="n">M</span><span class="o">---------</span><span class="n">X</span><span class="o">-------</span><span class="n">M</span>
          <span class="o">|</span>   <span class="o">|</span>         <span class="o">|</span>       <span class="o">|</span>
<span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-----</span><span class="n">X</span><span class="o">---|--</span><span class="n">M</span><span class="o">------|---</span><span class="n">X</span><span class="o">---|--</span><span class="n">M</span>
              <span class="o">|</span>  <span class="o">|</span>      <span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>  <span class="o">|</span>
<span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">---------*--|------*---*---*--|--</span>
                 <span class="o">|</span>                 <span class="o">|</span>
<span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">------------*-----------------*--</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h4>リセットゲート<a class="headerlink" href="#id7" title="Permalink to this heading">¶</a></h4>
<p>特定の量子ビットを強制的に|0&gt;にすることができます。例えば、以下のよう
にresetメソッドを使います。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">qid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<p>qidオプションには|0&gt;にしたい量子ビット番号を指定します。</p>
</div>
</div>
<div class="section" id="id8">
<h3>量子計算の実行<a class="headerlink" href="#id8" title="Permalink to this heading">¶</a></h3>
<p>量子計算を実行するには、Backendクラスのrunメソッドを使います。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bk</span> <span class="o">=</span> <span class="n">Backend</span><span class="p">()</span>  <span class="c1"># qlazyの状態ベクトルシミュレータ(デフォルト)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">qid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">cid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qcirc</span><span class="o">=</span><span class="n">qc</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>上記のようにrunメソッドの引数qcircに量子回路、引数shotsに測定回数を指
定します。結果はresult(Resultクラスのインスタンス)に格納されます。
Resultにはcidとfrequencyという2つのプロパティが定義されていて、各々、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">cid</span><span class="p">)</span>
<span class="go">[0,1]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>
<span class="go">Counter({&#39;00&#39;: 52, &#39;11&#39;: 48})</span>
</pre></div>
</div>
<p>のように値を取り出すことができます。cidは測定値が格納されている古典レ
ジスタの番号リストです。runのオプションとして頻度を取得したい古典レジ
スタ番号cidを指定することもできます。例えば、上の回路で、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qcirc</span><span class="o">=</span><span class="n">qc</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">cid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<p>とすると、0番目の古典レジスタに入る値の頻度だけ取り出すことができて、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">cid</span><span class="p">)</span>
<span class="go">[0]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>
<span class="go">Counter({&#39;0&#39;: 52, &#39;1&#39;: 48})</span>
</pre></div>
</div>
<p>という結果を得ることができます(いわゆる周辺化ですね)。cidを省略した場
合、全古典レジスタにわたり頻度が計算されます。</p>
<p>その他、バックエンド情報、量子ビット数、古典ビット数、測定した回数、計
算開始時刻、計算終了時刻、計算時間がResultのプロパティとして定義されていて、
各々以下のように取得することができます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">backend</span><span class="p">)</span>
<span class="go">{&#39;product&#39;: &#39;qlazy&#39;, &#39;device&#39;: &#39;qstate_simulator&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">qubit_num</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">cmem_num</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">shots</span><span class="p">)</span>
<span class="go">100</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">start_time</span><span class="p">)</span>
<span class="go">2022-03-05 13:32:33.837965</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">end_time</span><span class="p">)</span>
<span class="go">2022-03-05 13:32:33.842534</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">)</span>
<span class="go">0.004569</span>
</pre></div>
</div>
<p>とりあえず測定値の頻度だけわかりやすく見たいという場合は、
showメソッドを使って、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>とすれば、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">freq</span><span class="p">[</span><span class="mi">00</span><span class="p">]</span> <span class="o">=</span> <span class="mi">54</span> <span class="p">(</span><span class="mf">0.5400</span><span class="p">)</span> <span class="o">|+++++++++++++++++</span>
<span class="n">freq</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="mi">46</span> <span class="p">(</span><span class="mf">0.4600</span><span class="p">)</span> <span class="o">|++++++++++++++</span>
</pre></div>
</div>
<p>と棒グラフで頻度を可視化して見ることができます。
棒グラフだけでなく、すべてを一度に表示したい場合は、
verboseオプションをTrueにして、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>とすれば、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">backend</span><span class="p">]</span>
<span class="o">-</span> <span class="n">product</span>      <span class="o">=</span> <span class="n">qlazy</span>
<span class="o">-</span> <span class="n">device</span>       <span class="o">=</span> <span class="n">qstate_simulator</span>
<span class="p">[</span><span class="n">qubit</span> <span class="o">&amp;</span> <span class="n">cmem</span><span class="p">]</span>
<span class="o">-</span> <span class="n">qubit_num</span>    <span class="o">=</span> <span class="mi">2</span>
<span class="o">-</span> <span class="n">cmem_num</span>     <span class="o">=</span> <span class="mi">2</span>
<span class="p">[</span><span class="n">measurement</span><span class="p">]</span>
<span class="o">-</span> <span class="n">cid</span>          <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="o">-</span> <span class="n">shots</span>        <span class="o">=</span> <span class="mi">100</span>
<span class="p">[</span><span class="n">time</span><span class="p">]</span>
<span class="o">-</span> <span class="n">start_time</span>   <span class="o">=</span> <span class="mi">2022</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">15</span> <span class="mi">23</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mf">41.249034</span>
<span class="o">-</span> <span class="n">end_time</span>     <span class="o">=</span> <span class="mi">2022</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">15</span> <span class="mi">23</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mf">41.254211</span>
<span class="o">-</span> <span class="n">elassed</span> <span class="n">time</span> <span class="o">=</span> <span class="mf">0.005177</span> <span class="p">[</span><span class="n">sec</span><span class="p">]</span>
<span class="p">[</span><span class="n">histogram</span><span class="p">]</span>
<span class="o">-</span> <span class="n">freq</span><span class="p">[</span><span class="mi">00</span><span class="p">]</span> <span class="o">=</span> <span class="mi">54</span> <span class="p">(</span><span class="mf">0.5400</span><span class="p">)</span> <span class="o">|+++++++++++++++++</span>
<span class="o">-</span> <span class="n">freq</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="mi">46</span> <span class="p">(</span><span class="mf">0.4600</span><span class="p">)</span> <span class="o">|++++++++++++++</span>
</pre></div>
</div>
<p>のように表示させることができます。</p>
<p>この実行結果をファイルとして保存したり、保存したものを読み出すこともできます。
saveメソッドを使って、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;hoge.res&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>としてファイルhoge.resに保存しておいて、loadメソッド(classmethod)を使って、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">qlazy</span> <span class="kn">import</span> <span class="n">Result</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result_load</span> <span class="o">=</span> <span class="n">Result</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;hoge.res&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>とすれば、保存しておいた計算結果をロードして結果データを再度取得することができます。</p>
<p>Pythonワンライナーで、以下のように結果データを見ることもできます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -c &quot;from qlazy import Result; Result.load(&#39;hoge.res&#39;).show(verbose=True)&quot;
</pre></div>
</div>
<div class="section" id="id9">
<h4>行列積状態シミュレータでの測定に関する注意事項<a class="headerlink" href="#id9" title="Permalink to this heading">¶</a></h4>
<p>数十〜数百量子ビットの量子回路でもそれほど深くない回路でエンタングルが
あまりないような場合は難なく量子回路の演算が実行できたりするのですが、
最後に多数の量子ビットに対して大量のショット数で測定するようなことをす
ると、測定結果取得に途方もない時間がかかる場合があります。</p>
<p>行列積状態を使ったシミュレーションの主な用途は、NISCデバイス上での量子
機械学習や量子化学計算や最適化問題の求解等のシミュレーションと思われま
すので、測定値を取得するのではなく、すぐ下で説明するように行列積状態
MPStateのインスタンスを取得しておいてから、MPStateクラスのexpectメソッ
ドで期待値計算することをとりあえずおすすめします。</p>
</div>
<div class="section" id="qlazyqulacs">
<h4>量子状態の取得(qlazyおよびqulacsのみ)<a class="headerlink" href="#qlazyqulacs" title="Permalink to this heading">¶</a></h4>
<p>qlazyの状態ベクトルシミュレータ(qstate_simulator)またはスタビライザー
シミュレータ(stabilizer_simulator)または行列積状態シミュレータ
(mps_simulator)でrunを実行するときにout_stateオプションをTrueにセット
すると、Resultのプロパティqstateまたはstabilizerまたはmpstateに各クラ
スで規定されている量子状態がセットされます。これらをもとにQState,
Stabilizer, MPStateで定義されている各種計算が実行できます(例えばオブザー
バブルに対する期待値計算など)。詳細については各クラスに関するドキュメ
ントご参照してください。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qs_sim</span> <span class="o">=</span> <span class="n">Backend</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;qlazy&#39;</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;qstate_simulator&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">qs_sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qcirc</span><span class="o">=</span><span class="n">qc</span><span class="p">,</span> <span class="n">out_state</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qs</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">qstate</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qs</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">c[00] = +0.7071+0.0000*i : 0.5000 |++++++</span>
<span class="go">c[01] = +0.0000+0.0000*i : 0.0000 |</span>
<span class="go">c[10] = +0.0000+0.0000*i : 0.0000 |</span>
<span class="go">c[11] = +0.7071+0.0000*i : 0.5000 |++++++</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sb_sim</span> <span class="o">=</span> <span class="n">Backend</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;qlazy&#39;</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;stabilizer_simulator&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">sb_sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qcirc</span><span class="o">=</span><span class="n">qc</span><span class="p">,</span> <span class="n">out_state</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sb</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stabilizer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sb</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">g[0]:  XX</span>
<span class="go">g[1]:  ZZ</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mps_sim</span> <span class="o">=</span> <span class="n">Backend</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;qlazy&#39;</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;mps_simulator&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">mps_sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qcirc</span><span class="o">=</span><span class="n">qc</span><span class="p">,</span> <span class="n">out_state</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mps</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">mpstate</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mps</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">c[00] = +0.7071+0.0000*i : 0.5000 |++++++</span>
<span class="go">c[01] = +0.0000+0.0000*i : 0.0000 |</span>
<span class="go">c[10] = +0.0000+0.0000*i : 0.0000 |</span>
<span class="go">c[11] = +0.7071+0.0000*i : 0.5000 |++++++</span>
</pre></div>
</div>
<p>また、qulacsの状態ベクトルシミュレータ(cpu_simulator, gpu_simulator)で
も同様にして、qlazyの状態ベクトルを取得することができます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qs_sim</span> <span class="o">=</span> <span class="n">Backend</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;qulacs&#39;</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cpu_simulator&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">qs_sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qcirc</span><span class="o">=</span><span class="n">qc</span><span class="p">,</span> <span class="n">out_state</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qs</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">qstate</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qs</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">c[00] = +0.7071+0.0000*i : 0.5000 |++++++</span>
<span class="go">c[01] = +0.0000+0.0000*i : 0.0000 |</span>
<span class="go">c[10] = +0.0000+0.0000*i : 0.0000 |</span>
<span class="go">c[11] = +0.7071+0.0000*i : 0.5000 |++++++</span>
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h4>オブザーバブルの期待値<a class="headerlink" href="#id10" title="Permalink to this heading">¶</a></h4>
<p>量子回路を実行した後の状態に対して、オブザーバブルの期待値を計算したい
場合があります。そのような場合、Backendクラスのexpectメソッドが使えま
す。例えば、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>のような量子回路を通した後、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ob</span> <span class="o">=</span> <span class="n">Z</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">Z</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">Z</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">Z</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>のようなオブザーバブルの期待値を計算したい場合、以下のようにします。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bk</span> <span class="o">=</span> <span class="n">Backend</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;qlazy&#39;</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;qstate_simulator&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ob</span> <span class="o">=</span> <span class="n">Z</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">Z</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">Z</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">Z</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">exp</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">qcirc</span><span class="o">=</span><span class="n">qc</span><span class="p">,</span> <span class="n">observable</span><span class="o">=</span><span class="n">ob</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
</pre></div>
</div>
<p>expectメソッドのqcircオプションに量子回路、observableオプションにオブ
ザーバブル、shotsオプションに試行回数を設定すると、shotsの回数分、
qcircの量子回路を実行して、observableの測定を行い、その平均値を期待値
として出力することを行います。バックエンドとしてシミュレータを指定した
場合は、内部的に乱数を発生させてその測定をシミュレーションします。実機
を指定した場合は、実際の測定値を取得して期待値を計算します。従って、得
られる期待値は理論上期待される値からずれることになります。上の例の期待
値は理論上ゼロになるはずですが、実際には、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;exp = </span><span class="si">{:.6f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
<span class="go">exp = -0.001200+0.000000j</span>
</pre></div>
</div>
<p>のように少しずれます。理論上の期待値を得たい場合は、shotsオプションの変わりに
preciseオプションをTrueに設定します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">exp</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">qcirc</span><span class="o">=</span><span class="n">qc</span><span class="p">,</span> <span class="n">observable</span><span class="o">=</span><span class="n">ob</span><span class="p">,</span> <span class="n">precise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>こうすると、内部的に理論上の計算（行列演算）を実行して正確な期待値を出力します。
表示してみます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;exp = </span><span class="si">{:.6f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
<span class="go">-0.000000+0.000000j	</span>
</pre></div>
</div>
<p>ただし、これが実行できるのはバックエンドにシミュレータが指定されている
場合、具体的にはqlazyのqstate_simulatorとqstate_gpu_simulatorと
mps_simulator、およびqulacsのcpu_simulatorとgpu_simulatorのみです。</p>
</div>
</div>
<div class="section" id="id11">
<h3>対応している量子ゲート<a class="headerlink" href="#id11" title="Permalink to this heading">¶</a></h3>
<p>以下に利用可能な量子ゲートの一覧を示します。指定できる引数はQStateクラ
スやDensOpクラスのものと同様で、さらに上で説明したctrlという引数がすべ
てユニタリゲートで指定できます(非ユニタリゲートには指定できません)。</p>
<div class="section" id="id12">
<h4>1量子ビットゲート(ユニタリゲート)<a class="headerlink" href="#id12" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>x,y,z: Pauli X/Y/Z gate</p></li>
<li><p>h: Hadamard gate</p></li>
<li><p>xr,xr_dg: root X and root X dagger gate</p></li>
<li><p>s,s_dg: S and S dagger gate</p></li>
<li><p>t,t_dg: T and T dagger gate</p></li>
<li><p>p: phase shift gate</p></li>
<li><p>rx,ry,rz: RX/RY/RZ (rotation around X/Y/Z-axis) gate</p></li>
</ul>
</div>
<div class="section" id="id13">
<h4>2量子ビットゲート(ユニタリゲート)<a class="headerlink" href="#id13" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>cx,cy,cz: controlled X/Y/Z gate</p></li>
<li><p>cxr,cxr_dg: controlled XR and XR dagger gate</p></li>
<li><p>ch: controlled Hadamard gate</p></li>
<li><p>cs,cs_dg: controlled S and S dagger gate</p></li>
<li><p>ct,ct_dg: controlled T and T dagger gate</p></li>
<li><p>sw: swap gate</p></li>
<li><p>cp: controlled P gate</p></li>
<li><p>crx,cry,crz: controlled RX/RY/RZ gate</p></li>
<li><p>rxx,ryy,rzz: Ising coupling gate</p></li>
</ul>
</div>
<div class="section" id="id14">
<h4>3量子ビットゲート(ユニタリゲート)<a class="headerlink" href="#id14" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>ccx: toffoli gate (or CCX gate, controlled controlled X gate)</p></li>
<li><p>csw: fredkin gate (or controlled swap gate)</p></li>
</ul>
</div>
<div class="section" id="id15">
<h4>測定ゲート(非ユニタリゲート)<a class="headerlink" href="#id15" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>measure: measurement gate (computational basis)</p></li>
</ul>
</div>
<div class="section" id="id16">
<h4>リセットゲート(非ユニタリゲート)<a class="headerlink" href="#id16" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>reset: reset gate (computational basis)</p></li>
</ul>
</div>
<div class="section" id="id17">
<h4>注意：スタビライザーシミュレータの場合<a class="headerlink" href="#id17" title="Permalink to this heading">¶</a></h4>
<p>‘qlazy_stabilizer_simulator’の場合、指定できるのはクリフォードゲート
(x,y,z,h,s,s_dg,cx,cy,cz)のみです。</p>
</div>
</div>
</div>
<div class="section" id="id18">
<h2>量子回路の操作<a class="headerlink" href="#id18" title="Permalink to this heading">¶</a></h2>
<div class="section" id="id19">
<h3>量子回路の表示<a class="headerlink" href="#id19" title="Permalink to this heading">¶</a></h3>
<p>作成した量子回路はprint関数で表示することができます。例えば、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">qid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ctrl</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ctrl</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">qid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">cid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">qc</span><span class="p">)</span>
</pre></div>
</div>
<p>とすると、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">h</span> <span class="mi">0</span>
<span class="n">cx</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="n">measure</span> <span class="mi">0</span> <span class="o">-&gt;</span> <span class="mi">0</span>
<span class="n">x</span> <span class="mi">0</span> <span class="p">,</span> <span class="n">ctrl</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">x</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">ctrl</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">measure</span> <span class="mi">0</span> <span class="o">-&gt;</span> <span class="mi">0</span>
<span class="n">measure</span> <span class="mi">1</span> <span class="o">-&gt;</span> <span class="mi">1</span>
</pre></div>
</div>
<p>のように表示されます。また、showメソッドを使ってもう少しビジュアルに表
示することもできます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">q[0] -H-*-M-X---M---</span>
<span class="go">q[1] ---X-|-|-X-|-M-</span>
<span class="go">c  =/=====v=^=^=v=v=</span>
<span class="go">    2     0 0 0 0 1</span>
</pre></div>
</div>
<p>画面幅に入り切らない長い（深い）量子回路を表示したい場合、widthオプショ
ンで改行する幅を指定することができます。デフォルト値はwidth=100です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="go">&gt;&gt;&gt;&gt; qc.show(width=60)</span>
<span class="go">q[0] -Z---------X-Z-H-X-X-------*-T-S-X-X-------X-X-X-----S-</span>
<span class="go">q[1] ---------S-|---T---|-H-H-X-|-T-----|-*-------X-|---*-H-</span>
<span class="go">q[2] -H-X-X-T-H-|-------*-------|-S-S---|-|---------|-S-|-Z-</span>
<span class="go">q[3] -----------|---T-----------|-H-----*-|-X-*-X-S-*---|-S-</span>
<span class="go">q[4] -H-------X-*---------------X---X-----X---X---T---Z-X---</span>
<span class="go">c  =/=======================================================</span>
<span class="go">    5</span>

<span class="go">----*-X-------X-Z-------------------T-Z-T-X-X-H-X-X-H-Z---X-</span>
<span class="go">*---|-|-H-X-X---X-X-*-X-Z---H-H-T---------|-|-H---|-------|-</span>
<span class="go">|-Z-X-*-----*-------|-H---*-X-S-----T-T---|-|-S---*-X-S-X-|-</span>
<span class="go">|---------S-------H-X-Z-S-X-T-X---*-X---Z-*-*-X-T-------*-*-</span>
<span class="go">X-----------------T---------H---S-X-----T-----------X-T-----</span>
<span class="go">============================================================</span>

<span class="go">Z-S---S-----X-----------M---------</span>
<span class="go">------------|-----*---S-|-M-------</span>
<span class="go">H-----T-----|---S-|-S-S-|-|-M-----</span>
<span class="go">H-S-*---*---*-X---|---S-|-|-|-M---</span>
<span class="go">----X---X-H---*---X-----|-|-|-|-M-</span>
<span class="go">========================v=v=v=v=v=</span>
<span class="go">                        0 1 2 3 4</span>
</pre></div>
</div>
<div class="section" id="id20">
<h4>量子回路の同等性<a class="headerlink" href="#id20" title="Permalink to this heading">¶</a></h4>
<p>2つの量子回路が全く同じものかどうか（同等性と呼ぶことにします）は
論理演算子’==’で判定できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc_A</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc_B</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc_C</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">qc_A</span> <span class="o">==</span> <span class="n">qc_B</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">qc_A</span> <span class="o">==</span> <span class="n">qc_C</span><span class="p">)</span>
<span class="go">False</span>
</pre></div>
</div>
<p>量子回路の等価性（一見違うように見えていても実は同等の効果を及ぼす回路）
の判定については後述します。</p>
</div>
<div class="section" id="id21">
<h4>量子回路の連結<a class="headerlink" href="#id21" title="Permalink to this heading">¶</a></h4>
<p>複数の量子回路を’+’でつなげることで連結させることができます。例えば、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc_A</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc_B</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc_C</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">qid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<p>という3つの量子回路があったとき、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">qc_A</span> <span class="o">+</span> <span class="n">qc_B</span> <span class="o">+</span> <span class="n">qc_C</span>
</pre></div>
</div>
<p>のようにすると、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span><span class="n">H</span><span class="o">-*-</span><span class="n">M</span><span class="o">-</span>
<span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">---</span><span class="n">X</span><span class="o">-|-</span>
<span class="n">c</span>  <span class="o">=/=====</span><span class="n">v</span><span class="o">=</span>
    <span class="mi">1</span>     <span class="mi">0</span>
</pre></div>
</div>
<p>という量子回路を作成することができます。また、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">qc_A</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">+=</span> <span class="n">qc_B</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">+=</span> <span class="n">qc_C</span>
</pre></div>
</div>
<p>のようにインクリメント演算子を使って連結することも可能です。</p>
<p>また、同じ量子回路を繰り返して連結したい場合、’*’を使うこともできます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc_A</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">qc_A</span> <span class="o">*</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">q[0] -H-*-H-*-H-*-</span>
<span class="go">q[1] ---X---X---X-</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id22">
<h3>量子回路の統計情報<a class="headerlink" href="#id22" title="Permalink to this heading">¶</a></h3>
<p>ここまでの説明でお気づきかと思いますが、qlazyでは最初の量子回路生成</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span>
</pre></div>
</div>
<p>の段階で使用する量子ビット数や古典ビット数を明示的に指定しておく必要はありません。
追加された量子ゲート情報から自動的に内部で都度更新・保持されます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qubit_num</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">qubit_num</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cmem_num</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">cmem_num</span>
</pre></div>
</div>
<p>で、量子ビット数と古典ビット数を取得できます。
また、使用されている量子ゲートの数も、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">gate_num</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">gate_num</span>
</pre></div>
</div>
<p>で取得できます。例えば、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">qc</span><span class="o">.</span><span class="n">qubit_num</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">qc</span><span class="o">.</span><span class="n">cmem_num</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">qc</span><span class="o">.</span><span class="n">gate_num</span><span class="p">)</span>
<span class="go">2</span>
</pre></div>
</div>
<p>となります。</p>
<p>ここで1点注意事項があります。QCircで利用可能な量子ゲートは上述の通りな
のですが、内部的に扱われている量子ゲートは、
x,z,h,s,s_dg,t,t_dg,rx,rz,cx,cz,ch,crz,measure,resetの15種類に限定され
ています。他の量子ゲートはこれらを組み合わせて内部的に表現されています。
例えば、swゲートは、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>のように3個のゲート演算の形に展開されています。crxは、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">crz</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>のように展開されています。また、measureやresetは1量子ビットごとの演算に展開されます。
つまり、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">qid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">cid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">qid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<p>は、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">qid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">qid</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cid</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">qid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">qid</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<p>のように展開されます。なので、qc.gate_numで取得した値が自分の意図した
値よりも大きくなっていて、ん？となることがあるかもしれませんが、このよ
うな理由によるものです(どのように展開されたかはprint(qc)で確認できます)。</p>
<p>量子ビット数、古典ビット数、量子ゲート数に加えて、量子ゲートの頻度を知りたい場合、
get_statsメソッドを使えば、一気に取得することができます。
以下のような辞書データとして結果が得られます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">qid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">cid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">qc</span><span class="o">.</span><span class="n">get_stats</span><span class="p">())</span>
<span class="go">{&#39;qubit_num&#39;: 2, &#39;cmem_num&#39;: 2, &#39;gate_num&#39;: 5, &#39;gate_freq&#39;: Counter({&#39;measure&#39;: 2, &#39;h&#39;: 1, &#39;cx&#39;: 1, &#39;t&#39;: 1}), &#39;gatetype_freq&#39;: Counter({&#39;unitary&#39;: 3, &#39;clifford&#39;: 2, &#39;non-unitary&#39;: 2, &#39;non-clifford&#39;: 1})}</span>
</pre></div>
</div>
</div>
<div class="section" id="id23">
<h3>量子回路の生成<a class="headerlink" href="#id23" title="Permalink to this heading">¶</a></h3>
<p>量子計算の性能評価とか量子回路最適化の研究等でランダムな量子回路を作り
たくなることがあります。そんなときはget_random_gatesメソッド
(classmethod)が使えます。例えば、以下のようにします。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="o">.</span><span class="n">generate_random_gates</span><span class="p">(</span><span class="n">qubit_num</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">gate_num</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">prob</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;h&#39;</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;cx&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;rx&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;crz&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span>
</pre></div>
</div>
<p>ここで、qubit_numとgate_numは作成したい量子回路の量子ビット数と量子ゲー
ト数を指定します。</p>
<p>probは量子ゲートの出現確率を辞書形式で指定します。
上の例ではhとcxとrxとcrzを7:5:3:3の割合で出現させます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">prob</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;h&#39;</span><span class="p">:</span><span class="mf">0.7</span><span class="p">,</span> <span class="s1">&#39;cx&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;rx&#39;</span><span class="p">:</span><span class="mf">0.3</span><span class="p">,</span> <span class="s1">&#39;crz&#39;</span><span class="p">:</span><span class="mf">0.3</span><span class="p">}</span>
</pre></div>
</div>
<p>のように小数で指定しても良いです(足して1.0にしなくても内部で適当に処
理してくれます)。対応しているゲートは、
x,z,h,s,s_dg,t,t_dg,rx,rz,cx,cz,ch,crzの13種類です。
非ユニタリゲート(measure, reset)は指定できません。</p>
<p>phaseは回転系のゲートがある場合に有効になります(回転系がない場合、指定は無視されます)。
rxとかcrzなどの位相をどのようにバラけさせたいかをタプルで指定します(何個指定しても良いです)。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">phase</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
<p>とすると、回転系のゲートが出現した場合、0.0<em>piか0.25</em>piか0.5*piかが均
等確率で設定されます。</p>
<p>以上、print(qc)すると、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">h</span> <span class="mi">3</span>
<span class="n">h</span> <span class="mi">4</span>
<span class="n">rx</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span> <span class="mi">3</span>
<span class="n">h</span> <span class="mi">2</span>
<span class="n">cx</span> <span class="mi">2</span> <span class="mi">4</span>
<span class="n">h</span> <span class="mi">2</span>
<span class="n">h</span> <span class="mi">2</span>
<span class="n">crz</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="n">cx</span> <span class="mi">3</span> <span class="mi">4</span>
<span class="n">h</span> <span class="mi">4</span>
<span class="o">...</span>
</pre></div>
</div>
<p>のような回路が作成されていることが確認できます。</p>
</div>
<div class="section" id="id24">
<h3>量子回路の保存と読み込み<a class="headerlink" href="#id24" title="Permalink to this heading">¶</a></h3>
<p>作成した量子回路をファイルに書き出したり、書き出されたファイルを読み込むことができます。</p>
<p>まず、書き出す場合はsaveメソッドを使って、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc_A</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">qid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">cid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc_A</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;hoge.qc&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>のようにします。これでhoge.qcというファイルにqcの内容が書き出されます(内部でpickle使ってます)。</p>
<p>読み込む場合は、loadメソッド(classmethod)を使って、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc_B</span> <span class="o">=</span> <span class="n">QCirc</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;hoge.qc&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>のようにします。</p>
</div>
<div class="section" id="openqasm">
<h3>OpenQASMのエクスポートとインポート<a class="headerlink" href="#openqasm" title="Permalink to this heading">¶</a></h3>
<p>qlazyで作成した量子回路をOpenQASM形式の文字列やファイルにエクスポート
したり、それらをインポートすることができます。</p>
<p>to_qasmメソッドを使って、以下のようにQpenQASM形式の文字列を出力するこ
とができます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qasm</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">to_qasm</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">qasm</span><span class="p">)</span>
<span class="go">OPENQASM 2.0;</span>
<span class="go">include &quot;qelib1.inc&quot;;</span>
<span class="go">qreg q[2];</span>
<span class="go">h q[0];</span>
<span class="go">cx q[0],q[1];</span>
</pre></div>
</div>
<p>to_qasm_fileメソッドを使って、以下のようにOpenQASM形式のファイルを出力
することができます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span><span class="o">.</span><span class="n">to_qasm_file</span><span class="p">(</span><span class="s2">&quot;foo.qasm&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>また、from_qasmメソッドおよびfrom_qasm_fileメソッド(staticmethod)を使って、
以下のようにOpenQASM(バージョン2.0)の文字列およびファイルからqlazyの量子回路を
作成することができます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="o">.</span><span class="n">from_qasm</span><span class="p">(</span><span class="n">qasm</span><span class="p">)</span>  <span class="c1"># qasm: OpenQASM string</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="o">.</span><span class="n">from_qasm_file</span><span class="p">(</span><span class="s2">&quot;foo.qasm&quot;</span><span class="p">)</span>  <span class="c1"># foo.qasm: OpenQASM file</span>
</pre></div>
</div>
<p>ただし、非ユニタリゲート(measure,reset)やユーザーがカスタマイズしたゲー
トには対応していません。対応しているゲートは、
x,y,z,h,s,sdg,t,tdg,cx,cz,ch,rx,rz,crzの14種類です。</p>
</div>
<div class="section" id="pyzx">
<h3>量子回路の等価性(pyzx利用)<a class="headerlink" href="#pyzx" title="Permalink to this heading">¶</a></h3>
<p>2つの量子回路が見た目は違っていても同じ効果を及ぼすユニタリゲートを表
している場合があります。ここでは、前述の「同等性」に対して「等価性」と呼ぶことにします。
qlazyでは、equivalentメソッドを使って等価であるかどうかを判断することができます
(ただし非ユニタリゲートは非対応)。
内部ではZX-calculusの計算ができるPythonモジュールである
<a class="reference external" href="https://github.com/Quantomatic/pyzx">pyzx</a>を使っていますので、
この機能を使う場合、pyzxがインストールされていなければなりません。</p>
<p>というわけで、簡単な例ですが、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">H</span><span class="o">--*--</span><span class="n">H</span><span class="o">--</span>
<span class="o">--</span><span class="n">H</span><span class="o">--</span><span class="n">X</span><span class="o">--</span><span class="n">H</span><span class="o">--</span>
</pre></div>
</div>
<p>と</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span><span class="n">X</span><span class="o">---</span>
<span class="o">---*---</span>
</pre></div>
</div>
<p>が等価であるということを確認してみます（知っておくと便利な公式です）。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc_A</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc_B</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">qc_A</span> <span class="o">==</span> <span class="n">qc_B</span><span class="p">)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">qc_A</span><span class="o">.</span><span class="n">equivalent</span><span class="p">(</span><span class="n">qc_B</span><span class="p">))</span>
<span class="go">True</span>
</pre></div>
</div>
<p>となり、確かに見た目が違うので同等ではないですが、
その意味するところは同じということで等価であることが確認できました。</p>
</div>
<div class="section" id="id25">
<h3>量子回路の最適化<a class="headerlink" href="#id25" title="Permalink to this heading">¶</a></h3>
<p>non-cliffordゲートであるTゲートはあらゆる量子アルゴリズムで活躍する重
要なゲートなのですが、ハードウェア的には難しいゲートなので、量子回路か
らなるべく追放したいのですが、単に追放しても意味のない回路になるだけなので、
等価性を保ったままTゲート数を削減できれば良いです。
このような意味での量子回路最適化はこれまでいろいろ研究がなされていて、
pyzxでもZX-calculusを使った手法が実装されています。
qlazyではこの機能(full_optimize)を使って最適化を実行することができます
(ただし非ユニタリゲートは非対応)。
以下のようにoptimizeメソッドを使います。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc_opt</span> <span class="o">=</span> <span class="n">qc_ori</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
</pre></div>
</div>
<p>試しに、h,cx,tを含んだ回路をランダムに発生させて、
optimeizeの効果をget_statsで見てみます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="o">.</span><span class="n">generate_random_gates</span><span class="p">(</span><span class="n">qubit_num</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">gate_num</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;h&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;cx&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc_opt</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;== before ==&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">qc</span><span class="o">.</span><span class="n">get_stats</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;== after ==&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">qc_opt</span><span class="o">.</span><span class="n">get_stats</span><span class="p">())</span>
</pre></div>
</div>
<p>とすると、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">==</span> <span class="n">before</span> <span class="o">==</span>
<span class="p">{</span><span class="s1">&#39;qubit_num&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;cmem_num&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;gate_num&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;gate_freq&#39;</span><span class="p">:</span> <span class="n">Counter</span><span class="p">({</span><span class="s1">&#39;cx&#39;</span><span class="p">:</span> <span class="mi">45</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="mi">29</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="mi">26</span><span class="p">}),</span> <span class="s1">&#39;gatetype_freq&#39;</span><span class="p">:</span> <span class="n">Counter</span><span class="p">({</span><span class="s1">&#39;unitary&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;clifford&#39;</span><span class="p">:</span> <span class="mi">74</span><span class="p">,</span> <span class="s1">&#39;non-clifford&#39;</span><span class="p">:</span> <span class="mi">26</span><span class="p">})}</span>
<span class="o">==</span> <span class="n">after</span> <span class="o">==</span>
<span class="p">{</span><span class="s1">&#39;qubit_num&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;cmem_num&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;gate_num&#39;</span><span class="p">:</span> <span class="mi">107</span><span class="p">,</span> <span class="s1">&#39;gate_freq&#39;</span><span class="p">:</span> <span class="n">Counter</span><span class="p">({</span><span class="s1">&#39;cx&#39;</span><span class="p">:</span> <span class="mi">55</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="s1">&#39;cz&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span> <span class="s1">&#39;rz&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;s_dg&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}),</span> <span class="s1">&#39;gatetype_freq&#39;</span><span class="p">:</span> <span class="n">Counter</span><span class="p">({</span><span class="s1">&#39;unitary&#39;</span><span class="p">:</span> <span class="mi">107</span><span class="p">,</span> <span class="s1">&#39;clifford&#39;</span><span class="p">:</span> <span class="mi">97</span><span class="p">,</span> <span class="s1">&#39;non-clifford&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">})}</span>
</pre></div>
</div>
<p>となりました。non-cliffordゲートは26個から10個に減りました(t:3個,rz:7個)。
その分、別のcliffordゲートが加わりますが、
non-cliffordゲートが減ったことの方がうれしいのです(と思います)。</p>
</div>
<div class="section" id="id26">
<h3>pyzxとのインターフェース<a class="headerlink" href="#id26" title="Permalink to this heading">¶</a></h3>
<p>pyzxにはいろんな機能があって最適化に限ってみてもいろんな最適化ができるようになっています。
また、ZX-calculusのグラフを表示したり編集したりする機能もあったりします。諸々遊びたい人のために、
pyzxのCircuitを入出力する機能も用意しました。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">zxqc</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">to_pyzx</span><span class="p">()</span>
</pre></div>
</div>
<p>でpyzxのCircuitインスタンスを吐き出すことができます。また、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="o">.</span><span class="n">from_pyzx</span><span class="p">(</span><span class="n">zxqc</span><span class="p">)</span>
</pre></div>
</div>
<p>でCircuitインスタンスをqlazyのQCircインスタンスに変換できます。</p>
</div>
<div class="section" id="id27">
<h3>カスタムゲートの追加<a class="headerlink" href="#id27" title="Permalink to this heading">¶</a></h3>
<p>QCircクラスを継承することで、自分専用の量子ゲートを簡単に作成・追加す
ることができます。ベル状態を作成する回路をbellメソッドとして、QCircを
継承したMyQCircクラスに追加する例を示します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyQCirc</span><span class="p">(</span><span class="n">QCirc</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">bell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q0</span><span class="p">,</span> <span class="n">q1</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">q0</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="n">q0</span><span class="p">,</span><span class="n">q1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="k">return</span> <span class="bp">self</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bk</span> <span class="o">=</span> <span class="n">Backend</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">MyQCirc</span><span class="p">()</span><span class="o">.</span><span class="n">bell</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">qid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">cid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qcirc</span><span class="o">=</span><span class="n">qc</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">...</span>
</pre></div>
</div>
<p>これは非常に簡単な例なのであまりご利益を感じないかもしれませんが、大き
な量子回路を繰り返し使いたい場合など、便利に使える場面は多いと思います。</p>
</div>
<div class="section" id="id28">
<h3>パラメトリック量子回路<a class="headerlink" href="#id28" title="Permalink to this heading">¶</a></h3>
<p>量子回路に含まれるパラメータを様々に変化させて繰り返し実行したい場合が
あります。例えば、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">rz</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">crx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">qid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">cid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<p>のような量子回路があったとします。中に位相をパラメータとしたrzゲート、
crxゲートがあり、各々に具体的な値として0.2,0.3という値が設定されていま
す。例えば、この量子回路を実行した後、(0.2, 0.3)というパラメータを
(0.4, 0.5)にして同じ量子回路を実行したい場合、もう一度QCircのインスタ
ンスを生成して一から同じゲートを次々追加する必要があります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">rz</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">crx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">qid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">cid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<p>この程度の深さの量子回路であれば特に問題はないのですが、非常に深い量子
回路を相手にする場合や、何度もパラメータを更新して実行するような場合、
一から量子回路を組む必要があるこのやり方は無駄です。</p>
<p>そのような場合、パラメトリック量子回路を作成する方法がおすすめです。
いま説明したことを実行するためには、まず、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">rz</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">crx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">qid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">cid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<p>のように、位相の値を指定する代わりにtagオプションでタグ名を指定します。
こうしておいて、各々を0.2,0.3に設定する場合、set_paramsメソッドを使って、
各タグ名に対応した値を以下のように指定します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span><span class="o">.</span><span class="n">set_params</span><span class="p">({</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">})</span>
</pre></div>
</div>
<p>これで具体的な位相の値を含む量子回路が作成されたことになります。この回
路に対して</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bk</span> <span class="o">=</span> <span class="n">Bakcend</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qcirc</span><span class="o">=</span><span class="n">qc</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>のように実行することができます。その後、パラメータを0.4,0.5に変更した
い場合、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span><span class="o">.</span><span class="n">set_params</span><span class="p">({</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bk</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qcirc</span><span class="o">=</span><span class="n">qc</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>のようにパラメータをセットして、再び実行すれば良いです。
別の量子回路を新たに作成する必要はありません。</p>
</div>
<div class="section" id="id29">
<h3>制御量子ビットの追加<a class="headerlink" href="#id29" title="Permalink to this heading">¶</a></h3>
<p>量子回路（ユニタリ演算子）に制御量子ビットを追加して制御ユニタリ演算子を作成したい場合、
add_controlメソッドを使うことができます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">z</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">q[0] ---</span>
<span class="go">q[1] -X-</span>
<span class="go">q[2] -Z-</span>
</pre></div>
</div>
<p>このような量子回路に対して、0番目の量子ビットを制御ビットにする量子回路を作成するには、
以下にように、add_controlメソッドのオプションqctrlに0を与えれば良いです。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc_ctrl</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">add_control</span><span class="p">(</span><span class="n">qctrl</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc_ctrl</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">q[0] -*-*-</span>
<span class="go">q[1] -X-|-</span>
<span class="go">q[2] ---Z-</span>
</pre></div>
</div>
<p>これは非常に簡単な例なのでadd_controllのご利益を感じないと思いますので、
もう少し複雑な例を示します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">crz</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">q[0] -*-------</span>
<span class="go">q[1] -RZ(0.3)-</span>
</pre></div>
</div>
<p>このような量子回路に対して、2番目の量子ビットを制御ビットにする回路を作成すると、
以下のようになります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc_ctrl</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">add_control</span><span class="p">(</span><span class="n">qctrl</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc_ctrl</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">q[0] ------------*-------RZ(0.25)-X---*--------RZ(-0.25)-X--------------------------------*-------RZ</span>
<span class="go">q[1] -RZ(0.15)-H-RZ(0.5)-H--------|-H-RZ(-0.5)-H---------|-H-RZ(0.5)-H--------RZ(-0.15)-H-RZ(0.5)-H-</span>
<span class="go">q[2] -*---------------------------*----------------------*---*-------RZ(0.25)-*---------------------</span>

<span class="go">(0.25)-X---*--------RZ(-0.25)-X--------------------</span>
<span class="go">-------|-H-RZ(-0.5)-H---------|-H-RZ(0.5)-H--------</span>
<span class="go">-------*----------------------*---*-------RZ(0.25)-</span>
</pre></div>
</div>
</div>
<div class="section" id="id30">
<h3>量子ビット番号と古典ビット番号の付け替え<a class="headerlink" href="#id30" title="Permalink to this heading">¶</a></h3>
<p>作成した量子回路の量子ビット番号と古典ビット番号を付け替えたい場合、remapメソッドが使えます。
以下のような量子回路があったとします。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">qid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">cid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">q[0] -H-*-M---</span>
<span class="go">q[1] ---X-|-M-</span>
<span class="go">c  =/=====v=v=</span>
<span class="go">2         0 1</span>
</pre></div>
</div>
<p>これの量子ビット番号[0,1]を[1,0]にして、古典ビット番号[0,1]を[1,0]に変更した量子回路を作成する場合、
remapメソッドのqidオプションに[1,0]を設定し、cidオプションに[1,0]を設定します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc_new1</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">remap</span><span class="p">(</span><span class="n">qid</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">cid</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc_new1</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">q[0] ---X---M-</span>
<span class="go">q[1] -H-*-M-|-</span>
<span class="go">c  =/=====v=v=</span>
<span class="go">2         1 0</span>
</pre></div>
</div>
<p>これで新しい量子回路qc_new1が作成されました。
量子ビット番号を[2,1]に古典ビット番号を[1,0]に変更した量子回路は以下のように作成することができます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc_new2</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">remap</span><span class="p">(</span><span class="n">qid</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">cid</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc_new2</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">q[0] ---------</span>
<span class="go">q[1] ---X---M-</span>
<span class="go">q[2] -H-*-M-|-</span>
<span class="go">c  =/=====v=v=</span>
<span class="go">2         1 0</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id31">
<h2>対応しているバックエンド<a class="headerlink" href="#id31" title="Permalink to this heading">¶</a></h2>
<p>現在のバージョンで対応しているバックエンドは<a class="reference external" href="https://github.com/qulacs/qulacs">qulacs</a>と
<a class="reference external" href="https://quantum-computing.ibm.com/">IBM Quantum</a>と
<a class="reference external" href="https://aws.amazon.com/braket/?nc1=h_ls">Amazon Braket</a>です。
各々の使い方について、以下で説明します。</p>
<div class="section" id="qulacs">
<h3>qulacs<a class="headerlink" href="#qulacs" title="Permalink to this heading">¶</a></h3>
<p><a class="reference external" href="https://github.com/qulacs/qulacs">qulacs</a>は、<a class="reference external" href="https://qunasys.com/">株式会社
QunaSys</a>が提供しているオープンソースの量子回路シ
ミュレータで、GPUを利用して高速計算が実行できるという特徴があります。</p>
<p>qlazyの簡単なインターフェースでGPUを利用した高速計算を実行したい場合、
このバックエンドがおすすめです。</p>
<div class="section" id="id32">
<h4>準備<a class="headerlink" href="#id32" title="Permalink to this heading">¶</a></h4>
<p>まず、<a class="reference external" href="http://docs.qulacs.org/ja/latest/intro/1_install.html">Installation - Qulacs ドキュメント</a>
あたりを参照しながらインストールしてください（v0.3.0で動作確認しています）。</p>
</div>
</div>
<div class="section" id="id33">
<h3>使用法<a class="headerlink" href="#id33" title="Permalink to this heading">¶</a></h3>
<p>GPUを利用しないシミュレータで計算させたい場合、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bk</span> <span class="o">=</span> <span class="n">Backend</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;qulacs&#39;</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cpu_simulator&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>GPUを利用したシミュレータで計算させたい場合、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bk</span> <span class="o">=</span> <span class="n">Backend</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;qulacs&#39;</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;gpu_simulator&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>のように指定します(deviceを省略した場合のデフォルト値は’cpu_simulator’です)。</p>
<p>あとは上述したように、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">qid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">cid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qcirc</span><span class="o">=</span><span class="n">qc</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>のようにすれば、qulacsを使った計算ができます。</p>
</div>
<div class="section" id="ibm-quantum">
<h3>IBM Quantum<a class="headerlink" href="#ibm-quantum" title="Permalink to this heading">¶</a></h3>
<p><a class="reference external" href="https://quantum-computing.ibm.com/">IBM Quantum(IBMQ)</a>は、
<a class="reference external" href="https://www.ibm.com/jp-ja">IBM</a>が開発した量子コンピュータ（およびシミュ
レータ）を利用するためのクラウドサービスです。</p>
<div class="section" id="id34">
<h4>準備<a class="headerlink" href="#id34" title="Permalink to this heading">¶</a></h4>
<p>IBMQやローカルシミュレータをPythonから利用するためのライブラリである
<a class="reference external" href="https://qiskit.org/">qiskit</a>をインストールして、量子計算を実行できる
環境を整えてください（v0.34.2で動作確認しています）。例えば、<a class="reference external" href="https://dojo.qulacs.org/ja/latest/">Quantum Native
Dojo!</a>の<a class="reference external" href="https://dojo.qulacs.org/ja/latest/notebooks/3.2_Qiskit_IBMQ.html">3-2. QiskitとIBM Q
Experienceの使い
方</a>
に一連の手続きからサンプルコードまで含めて日本語でやさしく書かれていま
すので、これを参考にやってみるのが早いと思います。ただし、IBMQへのリン
クが古いみたいです。正しくは
<a class="reference external" href="https://quantum-computing.ibm.com/">https://quantum-computing.ibm.com/</a>
です。</p>
</div>
<div class="section" id="id35">
<h4>使用法<a class="headerlink" href="#id35" title="Permalink to this heading">¶</a></h4>
<p>本物の量子コンピュータを利用しないでローカルなシミュレータで計算させたい場合、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bk</span> <span class="o">=</span> <span class="n">Backend</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;ibmq&#39;</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;aer_simulator&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>のように指定します。本物の量子コンピュータを利用したい場合は、例えば、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bk</span> <span class="o">=</span> <span class="n">Backend</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;ibmq&#39;</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;least_busy&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>のように指定します。’least_busy’というのは、自分のアカウントで利用可能
な量子コンピュータシステムの中で、現在最も空いているシステムを自動選択
して実行するためのものです。実行するシステムを明示的に指定することもで
きます。例えば、’ibmq_athens’で実行したい場合、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bk</span> <span class="o">=</span> <span class="n">Backend</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;ibmq&#39;</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;ibmq_athens&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>のように指定します(deviceを省略した場合のデフォルト値は’aer_simulator’です)。</p>
<p>あとは上述したように、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">qid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">cid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qcic</span><span class="o">=</span><span class="n">qc</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>のようにすれば、IBMQを使った計算ができます。</p>
</div>
</div>
<div class="section" id="amazon-braket">
<h3>Amazon Braket<a class="headerlink" href="#amazon-braket" title="Permalink to this heading">¶</a></h3>
<p><a class="reference external" href="https://aws.amazon.com/braket/?nc1=h_ls">Amazon Braket</a>は、
<a class="reference external" href="https://ionq.com/">IonQ</a>、<a class="reference external" href="https://www.rigetti.com/">Rigetti</a>、
<a class="reference external" href="https://oxfordquantumcircuits.com/">Oxford Quantum Circuits</a>
などの量子コンピュータ（およびシミュレータ）を利用するためのクラウドサービスです。</p>
<div class="section" id="id36">
<h4>準備<a class="headerlink" href="#id36" title="Permalink to this heading">¶</a></h4>
<p><a class="reference external" href="https://aws.amazon.com/jp/console/">AWS</a>のアカウントがまず必要です。
その上で、</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/aws/amazon-braket-sdk-python">amazon-braket-sdk-python</a></p></li>
</ul>
<p>などを参考にしながら、<a class="reference external" href="https://aws.amazon.com/braket/?nc1=h_ls">Amazon Braket</a>
が利用できるようにします。以下の日本語の記事も参考になります。</p>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/snuffkin/items/29bc6ee24bc2bff55df3">Amazon Braketで量子コンピュータをはじめよう！</a></p></li>
<li><p><a class="reference external" href="https://note.com/navitime_tech/n/n497cebbeccf3">Amazon Braket を利用して手軽に量子コンピュータを動かす</a></p></li>
</ul>
<p>以下のようなコードが問題なく動くようになったら<a class="reference external" href="https://aws.amazon.com/braket/?nc1=h_ls">Amazon Braket</a>
の利用環境が整ったと思って良いです（多分）。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">boto3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">braket.aws</span> <span class="kn">import</span> <span class="n">AwsDevice</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">braket.circuits</span> <span class="kn">import</span> <span class="n">Circuit</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">device</span> <span class="o">=</span> <span class="n">AwsDevice</span><span class="p">(</span><span class="s2">&quot;arn:aws:braket:::device/quantum-simulator/amazon/sv1&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s3_folder</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;amazon-braket-xxxx&quot;</span><span class="p">,</span> <span class="s2">&quot;sv1&quot;</span><span class="p">)</span> <span class="c1"># Use the S3 bucket you created during onboarding</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bell</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cnot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">task</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">bell</span><span class="p">,</span> <span class="n">s3_folder</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">measurement_counts</span><span class="p">)</span>
</pre></div>
</div>
<p>さらに、qlazyから<a class="reference external" href="https://aws.amazon.com/braket/?nc1=h_ls">Amazon Braket</a>を利用できるようにするため、
ホームディレクトリに”~/.qlazy/”というディレクトリを作成して、その配下にconfig.iniというファイルを作り、
以下のように記述しておきます。’amazon-braket-xxxx’の部分はamazon braketを利用するために作成した
S3のbacket nameを書いておきます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat ~/.qlazy/config.ini
[backend_braket]
backet_name = amazon-braket-xxxx
</pre></div>
</div>
<p>また、poll_timeout_secondsをデフォルト値(5日)から変えたい場合、
例えば1日にしたい場合、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">backend_braket</span><span class="p">]</span>
<span class="n">backet_name</span> <span class="o">=</span> <span class="n">amazon</span><span class="o">-</span><span class="n">braket</span><span class="o">-</span><span class="n">xxxx</span>
<span class="n">poll_timeout_seconds</span> <span class="o">=</span> <span class="mi">86400</span>
</pre></div>
</div>
<p>のように指定します。</p>
<p>ちなみに動作確認している<a class="reference external" href="https://github.com/aws/amazon-braket-sdk-python">amazon-braket-sdk-python</a>
のバージョンはv1.18.0です。</p>
</div>
<div class="section" id="id37">
<h4>使用法<a class="headerlink" href="#id37" title="Permalink to this heading">¶</a></h4>
<p>Backendのインスタンスを生成する際にproductとdeviceを指定します。
braket関連のproductは、braket_local(ローカルシミュレータ)、
braket_aws(AWS上で動作するシミュレータ)、braket_ionq(IonQの量子コンピュータ)、
braket_rigetti(Rigettiの量子コンピュータ)、
braket_oqc(Oxford Quantum Circuits)の5種類です。
各々で利用できるdeviceは以下の通りです。</p>
<ul class="simple">
<li><p>braket_local</p>
<ul>
<li><p>braket_sv (状態ベクトルシミュレータ)</p></li>
</ul>
</li>
<li><p>braket_aws</p>
<ul>
<li><p>sv1 (状態ベクトルシミュレータ)</p></li>
<li><p>tn1 (テンソルネットワークシミュレータ)</p></li>
<li><p>dm1 (密度行列シミュレータ)</p></li>
</ul>
</li>
<li><p>braket_ionq</p>
<ul>
<li><p>ionq (IonQ)</p></li>
</ul>
</li>
<li><p>braket_rigetti</p>
<ul>
<li><p>aspen_11 (Aspen-11)</p></li>
<li><p>aspen_m_1 (Aspen-M-1)</p></li>
</ul>
</li>
<li><p>braket_oqc</p>
<ul>
<li><p>lucy (Lucy)</p></li>
</ul>
</li>
</ul>
<p>例えば、ローカルな状態ベクトルシミュレータを使う場合、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bk</span> <span class="o">=</span> <span class="n">Backend</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;braket_local&#39;</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;braket_sv&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>AWSの状態ベクトルシミュレータを使う場合、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bk</span> <span class="o">=</span> <span class="n">Backend</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;braket_aws&#39;</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;sv1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>IonQの量子コンピュータを使う場合、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bk</span> <span class="o">=</span> <span class="n">Backend</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;braket_ionq&#39;</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;ionq&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>RigettiのAspen-M-1を使う場合、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bk</span> <span class="o">=</span> <span class="n">Backend</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;braket_rigetti&#39;</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;aspnen_m_1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>OQCのLucyを使う場合、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bk</span> <span class="o">=</span> <span class="n">Backend</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;braket_oqc&#39;</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;lucy&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>のように指定します。あとは、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">qid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">cid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<p>のように量子回路を作成して、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qcic</span><span class="o">=</span><span class="n">qc</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>のようにすれば、Amazon Braketを使った計算ができます。</p>
</div>
<div class="section" id="id38">
<h4>注意事項<a class="headerlink" href="#id38" title="Permalink to this heading">¶</a></h4>
<p>測定が最後にある量子回路しか受け付けません。
したがって測定値に応じてオンオフするオプション(ctrl)も使えません。</p>
<p>また、braket_local以外のproductは有料になります。
以下のページに料金表がありますので参考にしてください。</p>
<p><a class="reference external" href="https://aws.amazon.com/jp/braket/pricing/">Amazon Braket Pricing</a></p>
</div>
</div>
</div>
<div class="section" id="gpu">
<h2>GPU版の利用<a class="headerlink" href="#gpu" title="Permalink to this heading">¶</a></h2>
<p>GPUを利用した高速な量子回路実行が可能です(v0.3.0より)。ただし、以下の
ようにGPU対応版をインストールする必要があります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/samn33/qlazy.git
$ cd qlazy
$ python setup_gpu.py install --user
</pre></div>
</div>
<p>インストールにあたりNVIDIA CUDA11の環境が整っていることが前提です。GPU
版がインストールされたかどうかは、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ qlazy -v
</pre></div>
</div>
<p>を実行して、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="n">Version</span><span class="p">:</span> <span class="mf">0.3.0</span><span class="o">-</span><span class="n">cuda</span>
</pre></div>
</div>
<p>と表示されたら、とりあえずインストールされたのだと思って良いです。もし、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="n">Version</span><span class="p">:</span> <span class="mf">0.3.0</span>
</pre></div>
</div>
<p>と表示されたとすると、あなたがお持ちのqlazyはCPU版です。</p>
<p>さて、無事GPU版がインストールされたとして、どうやって使うかを説明します。
CPU版の場合は、例えば、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">qlazy</span> <span class="kn">import</span> <span class="n">QCirc</span><span class="p">,</span> <span class="n">Backend</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bk</span> <span class="o">=</span> <span class="n">Backend</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;qlazy&#39;</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;qstate_simulator&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">qid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">cid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qcic</span><span class="o">=</span><span class="n">qc</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>でした。GPU版を使う場合は、Backendのインスタンス生成の時に、
deviceを’qstate_gpu_simulator’にするだけです。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">qlazy</span> <span class="kn">import</span> <span class="n">QCirc</span><span class="p">,</span> <span class="n">Backend</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bk</span> <span class="o">=</span> <span class="n">Backend</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;qlazy&#39;</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;qstate_gpu_simulator&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qc</span> <span class="o">=</span> <span class="n">QCirc</span><span class="p">()</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">qid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">cid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">bk</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qcic</span><span class="o">=</span><span class="n">qc</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>これでOKです。GPU対応のモジュールをimportするようなことは必要ありません。</p>
<p>いまのところGPU対応版で計算できるのは、状態ベクトルシミュレータを利用
した量子回路計算だけです。QStateやDensOpやStabilizerクラスのGPU版はあ
りません（そのうち作るかどうかは未定です）。</p>
<p>以上</p>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021-2022, Sam.N.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>